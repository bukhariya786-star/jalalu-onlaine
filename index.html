<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BUKHARIYA EDUCATIONAL CENTRE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    font-family: Arial, sans-serif;
    background:#eef2ef;
    margin:0;
    padding:20px;
}

.card{
    background:#fff;
    max-width:1100px;
    margin:auto;
    border-radius:20px;
    padding:25px;
    box-shadow:0 10px 30px rgba(0,0,0,.15);
}

/* Titles */
.title-main{
    color:#0b5e3b;
    text-align:center;
    font-size:30px;
    font-weight:700;
    letter-spacing:1px;
    margin-bottom:6px;
}

.title-sub{
    text-align:center;
    font-size:16px;
    letter-spacing:2px;
    color:#4f63ff;
    margin-top:0;
}

#datetime{
    text-align:center;
    margin-bottom:20px;
    color:#333;
}

/* Search */
input{
    width:100%;
    padding:10px;
    font-size:16px;
    border-radius:8px;
    border:2px solid #0b5e3b;
    background:#f9fffc;
    outline:none;
}

button{
    width:100%;
    padding:12px;
    font-size:16px;
    margin-top:12px;
    border:none;
    border-radius:10px;
    background:#0b5e3b;
    color:#fff;
    cursor:pointer;
}
button:hover{opacity:.9}

#error{
    color:red;
    text-align:center;
    margin-top:10px;
}

/* Tables */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
th,td{
    border:1px solid #ccc;
    padding:6px;
    text-align:center;
    font-size:13px;
}
th{
    background:#0b5e3b;
    color:#fff;
}

/* Present / Absent */
.p{
    background:#dcfce7;
    color:#065f46;
    font-weight:bold;
}
.a{
    background:#fee2e2;
    color:#991b1b;
    font-weight:bold;
}

/* Action buttons */
.actions{
    display:flex;
    gap:10px;
    margin-top:15px;
}
.actions button{
    width:33%;
    font-size:14px;
}

/* Mobile view attendance grid */
@media(max-width:768px){
    table:last-of-type tr{
        display:grid;
        grid-template-columns:repeat(8,1fr);
    }
    table:last-of-type th,
    table:last-of-type td{
        font-size:11px;
        padding:4px;
    }
}

/* Print / PDF */
@page{
    size:A4;
    margin:0;
}
@media print{
    body{padding:0;margin:0;background:#fff}
    .card{
        box-shadow:none;
        border-radius:0;
        max-width:100%;
        padding:20mm;
    }
    input,button,.actions{display:none}
}
</style>
</head>

<body>

<div class="card">

<h1 class="title-main">BUKHARIYA EDUCATIONAL CENTRE</h1>
<h2 class="title-sub">ONLINE STUDENTS ATTENDANCE REPORT</h2>
<div id="datetime"></div>

<input id="adno" placeholder="Enter Admission Number (Eg: BL11)">
<button onclick="searchStudent()">üîç Search</button>
<div id="error"></div>

<div id="result"></div>

<div class="actions" id="actions" style="display:none">
    <button onclick="window.print()">üìÑ Download PDF</button>
    <button onclick="location.reload()">üîÑ New Search</button>
    <button onclick="sendWhatsApp()">üì≤ Send WhatsApp</button>
</div>

</div>

<script>
const SHEET_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQQ-J8IvPnoIA-P1fbBemXE7tXLuT6_kODQamLC6xUUe2nnhAbRZ4zL2W13GNTm8rUQQrz2DpxNuoFB/pub?output=tsv";

function updateTime(){
    document.getElementById("datetime").innerText =
        new Date().toLocaleString();
}
setInterval(updateTime,1000); updateTime();

async function searchStudent(){
    const ad = document.getElementById("adno").value.trim().toUpperCase();
    document.getElementById("error").innerText="";
    document.getElementById("result").innerHTML="";
    document.getElementById("actions").style.display="none";

    const res = await fetch(SHEET_URL);
    const text = await res.text();
    const rows = text.split("\n").map(r=>r.split("\t"));

    for(let i=1;i<rows.length;i++){
        if(rows[i][1].toUpperCase()===ad){
            showData(rows[i]);
            return;
        }
    }
    document.getElementById("error").innerText="Admission number not found";
}

function showData(r){
    let html=`<table>
    <tr><th>Admission No</th><td>${r[1]}</td></tr>
    <tr><th>Name</th><td>${r[2]}</td></tr>
    <tr><th>Performance</th><td>${r[3]}</td></tr>
    </table><br><table><tr>`;

    for(let d=1;d<=31;d++) html+=`<th>${d}</th>`;
    html+=`<th>Total</th><th>Remarks</th></tr><tr>`;

    for(let i=4;i<=34;i++){
        let v=r[i];
        let cls = v==="P" ? "p" : v==="A" ? "a" : "";
        html+=`<td class="${cls}">${v}</td>`;
    }

    html+=`<td>${r[35]}</td><td>${r[36]}</td></tr></table>`;

    document.getElementById("result").innerHTML=html;
    document.getElementById("actions").style.display="flex";
}

function sendWhatsApp(){
    const text = document.getElementById("result").innerText;
    window.open("https://wa.me/?text="+encodeURIComponent(text));
}
</script>

</body>
</html>
